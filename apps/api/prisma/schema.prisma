generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CUSTOMER
  VENDOR
  ADMIN
}

enum VendorStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PropertyStatus {
  DRAFT
  PUBLISHED
  SUSPENDED
}

enum BookingStatus {
  PENDING_PAYMENT
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentProvider {
  STRIPE
  MANUAL
  OTHER
}

enum PaymentStatus {
  REQUIRES_ACTION
  AUTHORIZED
  CAPTURED
  FAILED
  REFUNDED
}

model User {
  id           String      @id @default(uuid())
  email        String      @unique
  passwordHash String
  role         UserRole    @default(CUSTOMER)

  vendorProfile VendorProfile?
  properties    Property[] @relation("VendorProperties")
  bookings      Booking[]  @relation("CustomerBookings")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
}

model VendorProfile {
  id          String       @id @default(uuid())
  userId      String       @unique
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  displayName String
  companyName String?
  phone       String?
  status      VendorStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
}

model Property {
  id          String         @id @default(uuid())
  vendorId    String
  vendor      User           @relation("VendorProperties", fields: [vendorId], references: [id], onDelete: Cascade)

  title       String
  slug        String         @unique
  description String?

  city        String
  area        String?
  address     String?
  lat         Float?
  lng         Float?

  maxGuests   Int            @default(2)
  bedrooms    Int            @default(1)
  bathrooms   Int            @default(1)

  basePrice   Int
  cleaningFee Int            @default(0)
  currency    String         @default("PKR")

  status      PropertyStatus @default(DRAFT)

  media       Media[]
  bookings    Booking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([vendorId])
  @@index([city])
  @@index([status])
}

model Media {
  id         String   @id @default(uuid())
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  url        String
  alt        String?
  sortOrder  Int      @default(0)

  createdAt DateTime @default(now())

  @@index([propertyId])
}

model Booking {
  id          String        @id @default(uuid())
  customerId  String
  customer    User          @relation("CustomerBookings", fields: [customerId], references: [id], onDelete: Cascade)

  propertyId  String
  property    Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  checkIn     DateTime
  checkOut    DateTime

  adults      Int           @default(1)
  children    Int           @default(0)

  status      BookingStatus @default(PENDING_PAYMENT)

  totalAmount Int
  currency    String        @default("PKR")

  payment     Payment?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([customerId])
  @@index([propertyId])
  @@index([status])
  @@index([checkIn, checkOut])
}

model Payment {
  id          String          @id @default(uuid())
  bookingId   String          @unique
  booking     Booking         @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  provider    PaymentProvider @default(STRIPE)
  status      PaymentStatus   @default(REQUIRES_ACTION)

  amount      Int
  currency    String          @default("PKR")

  providerRef String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([provider])
}
